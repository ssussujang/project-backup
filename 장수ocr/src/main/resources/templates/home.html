<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:rel="stylesheet" th:href = "@{/css/Login.css}">


</head>
<body>


	<table id ="menuTbl">
	
		<tr>
			<td class="title">
				<h2>영수증</h2>
			</td>
		</tr>
		
		
			
	</table>
	<table id="loginTbl" sec:authorize="isAnonymous()">
		
		<form action="/loginProc" method="post">
		
			<tr>
				<td class ="input">
					ID <input type="text" name="u_id" placeholder="아이디">
				</td>
			</tr>
			<tr>
				<td class ="input">
					PW <input type="password" name="u_pw" placeholder="비밀번호">
				</td>
			</tr>
			<tr>
				<td class = "loginbtn">
					<div th:if="${param.error}" style="color:red;">
						로그인 실패! 아이디 또는 비밀번호를 확인하세요.
					</div>
					<button type="submit">로그인</button>
					
					
		</form>		
					<button type="button" th:onclick="|location.href='@{/user/signup}'|">회원가입</button>
					
				</td>
				
			</tr>
	</table>
	
	<table id="userTbl" sec:authorize="isAuthenticated()">
		<tr>
			<td align="center" colspan="2">
				<span th:text="${#authentication.principal.userNameReal} + '님 환영합니다! 😊'"></span>
			</td>
		</tr>
			<td align="center">
				<button type="button" th:onclick="|location.href='@{/logout}'|">로그아웃</button>
			</td>
		
		<td align="center">
			<form th:action ="@{/user/mypage}" method="get">
				<button type="submit">마이페이지</button>
			</form>
		</td>
		
		</tr>	
	</table>
	
	
	
	
    <table id="homeTbl" sec:authorize="isAuthenticated()">
    	
    	<tr>
    		<td class="inputReceipt">
    			<h1 class="title">영수증 데이터 확인</h1>
    			<div id="result" th:if="${receipt != null}">
    				<form action="/receipt/save" method="post">
    			
				        <table align="center">
				            <tr>
				                <td>가게 <input th:value="${receipt.r_shop}" name="s_shop"></td>
				            </tr>
				            <tr>
				                <td>주소 <input th:value="${receipt.r_adrr}" name="s_adrr"></td>
				            </	tr>
				            <tr>
				                <td>날짜 <input th:value="${receipt.r_date}" name="s_date"></td>
				            </tr>
				            <tr>
				                <td>======= 상품 정보 =======</td>
				            </tr>
				
				            <tr th:each="item, stat : ${receipt.items}">
							    <td>
							        <p>상품명 <input th:name="'itemNames[' + ${stat.index} + ']'" th:value="${item.i_name}"></p>
							        <p>가격 <input th:name="'itemPrices[' + ${stat.index} + ']'" th:value="${item.i_price}"></p>
							        수량 <input th:name="'itemCounts[' + ${stat.index} + ']'" th:value="${item.i_count}"><hr>
							    </td>
							</tr>
				        </table>
				
				        <button>영수증 등록</button>
			     	</form>
			    </div>
			
			
			    <!-- 항상 표시되는 업로드 폼 -->
			    <div id="upload">
			        <form action="/receipt/uploadReceipt" method="post" enctype="multipart/form-data">
			            <input type="file" name="receipt" multiple>
			            <button type="submit">영수증 넣기</button>
			        </form>
			        <form action="/receipt/writeReceipt" method="get">
			           
			            <button type="submit">수기 입력</button>
			        </form>
			    </div>
    		
    		
    		</td>
    		
    	</tr>
    	
        
    </table>
	<table id="homeTbl" sec:authorize="isAnonymous()">
		
	   <tr>
    		<td th:replace="NotLogin :: NotLogin"></td>
    		
    	</tr>
		
	</table>
	
	
	
</body>
</html>